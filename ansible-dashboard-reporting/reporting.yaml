---
- name: Reporting Automation
  hosts: localhost
  vars_files:
    - vars/sample-data.yaml
  vars:
    status_title: "Demo App Stack - OS Patching Status"
    slack_channel: "#ansible"
    report_file_name: /var/www/html/dashboards/index.html
    report_server: utils.lab.iamgini.com
  tasks:
    - name: Render and post message to Slack
      ansible.builtin.include_role:
        name: notify-slack
      vars:
        slack_template: 'slack_status.json'
        channel: "{{ slack_channel }}"
      when: send_slack | default(false)

    - name: Generate report
      ansible.builtin.include_role:
        name: prepare-report
      vars:
        slack_template: 'slack_status.json'
        channel: "{{ slack_channel }}"
      loop: "{{ status_data.keys() }}"
      # when: generate_report | default(false)
